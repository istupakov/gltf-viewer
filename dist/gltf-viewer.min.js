!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("gl-matrix"));else if("function"==typeof define&&define.amd)define(["gl-matrix"],e);else{var r=e("object"==typeof exports?require("gl-matrix"):t["gl-matrix"]);for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(this,function(t){return function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var r={};return e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=5)}([function(e,r){e.exports=t},function(t,e,r){"use strict";function n(t,e){return Object.keys(t||{}).reduce(function(r,n){return r[n]=e(t[n],n),r},{})}function i(t){var e,r,n,i,a,u;return o(this,function(o){switch(o.label){case 0:o.trys.push([0,5,6,7]),e=s(Object.keys(t||{})),r=e.next(),o.label=1;case 1:return r.done?[3,4]:(n=r.value,[4,[n,t[n]]]);case 2:o.sent(),o.label=3;case 3:return r=e.next(),[3,1];case 4:return[3,7];case 5:return i=o.sent(),a={error:i},[3,7];case 6:try{r&&!r.done&&(u=e.return)&&u.call(e)}finally{if(a)throw a.error}return[7];case 7:return[2]}})}function a(t){return t[Object.keys(t)[0]]}var o=this&&this.__generator||function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,a&&(o=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(a,r[1])).done)return o;switch(a=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,a=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(o=u.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){u.label=r[1];break}if(6===r[0]&&u.label<o[1]){u.label=o[1],o=r;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(r);break}o[2]&&u.ops.pop(),u.trys.pop();continue}r=e.call(t,u)}catch(t){r=[6,t],a=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,a,o,s,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},s=this&&this.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}};Object.defineProperty(e,"__esModule",{value:!0}),e.map=n,e.enumerate=i,e.first=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=function(){function t(t,e){Object.assign(this,t),this.node=e}return t.prototype.updateProjection=function(t){var e=n.mat4.create();if("perspective"==this.type){var r=this.perspective,i=t.drawingBufferWidth/t.drawingBufferHeight;n.mat4.perspective(e,r.yfov,i,r.znear,r.zfar)}else{var a=this.orthographic;n.mat4.ortho(e,-a.xmag,a.xmag,-a.ymag,a.ymag,a.znear,a.zfar)}this.projection=e},t.prototype.updateView=function(){this.view=this.node.getViewMatrix()},t}();e.Camera=i},function(t,e,r){"use strict";function n(t){return o(this,void 0,void 0,function(){return s(this,function(e){return[2,new Promise(function(e){var r=new Image;r.src=t,r.onload=function(){return e(r)}})]})})}function i(t){return o(this,void 0,void 0,function(){var e,r,i,a,o,l,f,p,d,m,v,y,b,w,o,g,f,x,S,O,_,T,L,M,o,j,P,C,V,I,A,G,k,W,R;return s(this,function(s){switch(s.label){case 0:e={},s.label=1;case 1:s.trys.push([1,7,8,9]),r=u(h.enumerate(t.buffers)),i=r.next(),s.label=2;case 2:return i.done?[3,6]:(a=c(i.value,2),o=a[0],l=a[1],[4,fetch(l.uri)]);case 3:return f=s.sent(),p=e,d=o,[4,f.arrayBuffer()];case 4:if(p[d]=s.sent(),l.byteLength!=e[o].byteLength)throw"Wrong buffer size: "+o;s.label=5;case 5:return i=r.next(),[3,2];case 6:return[3,9];case 7:return m=s.sent(),I={error:m},[3,9];case 8:try{i&&!i.done&&(A=r.return)&&A.call(r)}finally{if(I)throw I.error}return[7];case 9:v={},s.label=10;case 10:s.trys.push([10,16,17,18]),y=u(h.enumerate(t.shaders)),b=y.next(),s.label=11;case 11:return b.done?[3,15]:(w=c(b.value,2),o=w[0],g=w[1],[4,fetch(g.uri)]);case 12:return f=s.sent(),x=v,S=o,[4,f.text()];case 13:x[S]=s.sent(),s.label=14;case 14:return b=y.next(),[3,11];case 15:return[3,18];case 16:return O=s.sent(),G={error:O},[3,18];case 17:try{b&&!b.done&&(k=y.return)&&k.call(y)}finally{if(G)throw G.error}return[7];case 18:_={},s.label=19;case 19:s.trys.push([19,24,25,26]),T=u(h.enumerate(t.images)),L=T.next(),s.label=20;case 20:return L.done?[3,23]:(M=c(L.value,2),o=M[0],j=M[1],P=_,C=o,[4,n(j.uri)]);case 21:P[C]=s.sent(),s.label=22;case 22:return L=T.next(),[3,20];case 23:return[3,26];case 24:return V=s.sent(),W={error:V},[3,26];case 25:try{L&&!L.done&&(R=T.return)&&R.call(T)}finally{if(W)throw W.error}return[7];case 26:return[2,new E(t,e,v,_)]}})})}function a(t){return o(this,void 0,void 0,function(){var e,r,n;return s(this,function(a){switch(a.label){case 0:return[4,fetch(t)];case 1:return e=a.sent(),[4,e.json()];case 2:return r=a.sent(),E.defaultModel?[3,4]:(n=E,[4,i(O)]);case 3:n.defaultModel=a.sent(),a.label=4;case 4:return[4,i(r)];case 5:return[2,a.sent()]}})})}var o=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,a){function o(t){try{u(n.next(t))}catch(t){a(t)}}function s(t){try{u(n.throw(t))}catch(t){a(t)}}function u(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(o,s)}u((n=n.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,a&&(o=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(a,r[1])).done)return o;switch(a=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,a=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(o=u.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){u.label=r[1];break}if(6===r[0]&&u.label<o[1]){u.label=o[1],o=r;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(r);break}o[2]&&u.ops.pop(),u.trys.pop();continue}r=e.call(t,u)}catch(t){r=[6,t],a=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,a,o,s,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},u=this&&this.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}},c=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,a=r.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)o.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return o};Object.defineProperty(e,"__esModule",{value:!0});var l=r(0),h=r(1),f=r(8),p=r(14),d=r(12),m=r(9),v=r(6),y=r(13),b=r(11),w=r(15),g=r(10),x=r(2),S=r(7),O={programs:{program0:{attributes:["a_position"],fragmentShader:"fragmentShader0",vertexShader:"vertexShader0"}},shaders:{vertexShader0:{type:35633,uri:"data:text/plain;base64,cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwoKdW5pZm9ybSBtYXQ0IHVfbW9kZWxWaWV3TWF0cml4Owp1bmlmb3JtIG1hdDQgdV9wcm9qZWN0aW9uTWF0cml4OwoKYXR0cmlidXRlIHZlYzMgYV9wb3NpdGlvbjsKCnZvaWQgbWFpbih2b2lkKQp7CiAgICBnbF9Qb3NpdGlvbiA9IHVfcHJvamVjdGlvbk1hdHJpeCAqIHVfbW9kZWxWaWV3TWF0cml4ICogdmVjNChhX3Bvc2l0aW9uLDEuMCk7Cn0="},fragmentShader0:{type:35632,uri:"data:text/plain;base64,cHJlY2lzaW9uIGhpZ2hwIGZsb2F0OwoKdW5pZm9ybSB2ZWM0IHVfZW1pc3Npb247Cgp2b2lkIG1haW4odm9pZCkKewogICAgZ2xfRnJhZ0NvbG9yID0gdV9lbWlzc2lvbjsKfQ=="}},techniques:{technique0:{attributes:{a_position:"position"},parameters:{modelViewMatrix:{semantic:"MODELVIEW",type:35676},projectionMatrix:{semantic:"PROJECTION",type:35676},emission:{type:35666,value:[.5,.5,.5,1]},position:{semantic:"POSITION",type:35665}},program:"program0",states:{enable:[2884,2929]},uniforms:{u_modelViewMatrix:"modelViewMatrix",u_projectionMatrix:"projectionMatrix",u_emission:"emission"}}}},E=function(){function t(e,r,n,i){var a=this;this.buffers={},this.shaders={},this.programs={},this.materials={},this.accessors={},this.nodes={},this.scenes={},this.textures={},this.meshes={},this.animations={},this.buffers=h.map(e.bufferViews,function(t){return new f.BufferView(t,r)}),this.accessors=h.map(e.accessors,function(t){return new v.Accessor(t,a)}),this.shaders=h.map(e.shaders,function(t,e){return new p.Shader(t,n[e])}),this.programs=h.map(e.programs,function(t){return new d.Program(t,a)}),this.textures=h.map(e.textures,function(t){return new w.Texture(t,e.samplers[t.sampler],i[t.source])}),this.nodes=h.map(e.nodes,function(t){return new b.Node(t)}),this.materials=h.map(e.materials,function(r){return r.technique?new m.Material(r,e.techniques[r.technique],w.Texture.textureCollection(a.textures),a):new m.Material(r,O.techniques.technique0,w.Texture.textureCollection(t.defaultModel.textures),t.defaultModel)}),this.meshes=h.map(e.meshes,function(t){return new g.Mesh(t,a)}),this.animations=h.map(e.animations,function(t){return new S.Animation(t,a)});try{for(var o=u(h.enumerate(this.nodes)),s=o.next();!s.done;s=o.next()){var l=c(s.value,2);l[0];l[1].init(this,e.cameras)}}catch(t){x={error:t}}finally{try{s&&!s.done&&(E=o.return)&&E.call(o)}finally{if(x)throw x.error}}this.scenes=h.map(e.scenes,function(t){return new y.Scene(t,a)}),this.activeScene=this.scenes[e.scene]||h.first(this.scenes),this.activeScene&&!this.activeScene.activeCamera&&(this.activeScene.activeCamera=this.createExternalCamera());var x,E}return t.prototype.createExternalCamera=function(){return console.log("Camera node don't defined. Create ext camera"),new x.Camera({name:"External Camera",perspective:{yfov:.660593,zfar:1e100,znear:.01},type:"perspective"},{getViewMatrix:function(){return l.mat4.lookAt(l.mat4.create(),[50,40,80],[0,0,0],[0,1,0])}})},t.prototype.setActiveCamera=function(t){if(this.activeScene){this.activeScene.update();var e=this.activeScene.activeCamera.view;this.activeScene.activeCamera=new x.Camera(this.activeScene.activeCamera,{getViewMatrix:function(){return t(l.mat4.clone(e))}})}},t.prototype.getScenes=function(){return Object.keys(this.scenes)},t.prototype.getCameras=function(){return this.activeScene?this.activeScene.cameras.map(function(t){return t.name}):void 0},t.prototype.draw=function(t,e){if(this.activeScene){try{for(var r=u(h.enumerate(this.animations)),n=r.next();!n.done;n=r.next()){var i=c(n.value,2);i[0];i[1].applyTime(e)}}catch(t){a={error:t}}finally{try{n&&!n.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}}this.activeScene.draw(t)}var a,o},t.prototype.delete=function(t){try{for(var e=u(h.enumerate(this.textures)),r=e.next();!r.done;r=e.next()){var n=c(r.value,2),i=(n[0],n[1]);i.delete(t)}}catch(t){y={error:t}}finally{try{r&&!r.done&&(b=e.return)&&b.call(e)}finally{if(y)throw y.error}}try{for(var a=u(h.enumerate(this.programs)),o=a.next();!o.done;o=a.next()){var s=c(o.value,2),i=(s[0],s[1]);i.delete(t)}}catch(t){w={error:t}}finally{try{o&&!o.done&&(g=a.return)&&g.call(a)}finally{if(w)throw w.error}}try{for(var l=u(h.enumerate(this.shaders)),f=l.next();!f.done;f=l.next()){var p=c(f.value,2),i=(p[0],p[1]);i.delete(t)}}catch(t){x={error:t}}finally{try{f&&!f.done&&(S=l.return)&&S.call(l)}finally{if(x)throw x.error}}try{for(var d=u(h.enumerate(this.buffers)),m=d.next();!m.done;m=d.next()){var v=c(m.value,2),i=(v[0],v[1]);i.delete(t)}}catch(t){O={error:t}}finally{try{m&&!m.done&&(E=d.return)&&E.call(d)}finally{if(O)throw O.error}}var y,b,w,g,x,S,O,E},t}();e.loadModel=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=function(){function t(){this.capture=!1,this.scale=1,this.rotation=n.quat.create()}return t.prototype.attach=function(t){this.element=t,t.addEventListener("mousedown",this),t.addEventListener("wheel",this),document.addEventListener("mousemove",this),document.addEventListener("mouseup",this)},t.prototype.detach=function(t){t.removeEventListener("mousedown",this),t.removeEventListener("wheel",this),document.removeEventListener("mousemove",this),document.removeEventListener("mouseup",this)},t.prototype.rotate=function(t){var e=n.quat.rotationTo(n.quat.create(),this.previousPositon,t);n.quat.mul(this.rotation,e,this.rotation)},t.prototype.handleEvent=function(t){if(t instanceof MouseEvent){t.target;if("mousedown"==t.type)this.capture=!0,this.lastX=t.offsetX,this.lastY=t.offsetY,this.previousPositon=this.projectToTrackball();else if("mouseup"==t.type)this.capture=!1;else if("mousemove"==t.type&&this.capture){this.lastX+=t.movementX,this.lastY+=t.movementY;var e=this.projectToTrackball();this.rotate(e),this.previousPositon=e}}t instanceof WheelEvent&&(t.stopPropagation(),this.scale*=t.deltaY>0?1.1:1/1.1)},t.prototype.projectToTrackball=function(){var t=2*this.lastX/this.element.clientWidth-1,e=1-2*this.lastY/this.element.clientHeight,r=1-t*t-e*e,i=r>0?Math.sqrt(r):0;return n.vec3.normalize(n.vec3.create(),[t,e,i])},t.prototype.getViewMatrix=function(t){var e=t,r=n.mat4.fromScaling(n.mat4.create(),[this.scale,this.scale,this.scale]),i=n.mat4.fromQuat(n.mat4.create(),this.rotation);return n.mat4.mul(e,e,n.mat4.mul(r,r,i))},t}();e.Trackball=i},function(t,e,r){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(i,a){function o(t){try{u(n.next(t))}catch(t){a(t)}}function s(t){try{u(n.throw(t))}catch(t){a(t)}}function u(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(o,s)}u((n=n.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,a&&(o=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(a,r[1])).done)return o;switch(a=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,a=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(o=u.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){u.label=r[1];break}if(6===r[0]&&u.label<o[1]){u.label=o[1],o=r;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(r);break}o[2]&&u.ops.pop(),u.trys.pop();continue}r=e.call(t,u)}catch(t){r=[6,t],a=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,a,o,s,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var o=r(3),s=r(4),u="\n    <style>\n        :host {\n            width: 400px;\n            height: 300px;\n            display: inline-block;\n        }\n    </style>",c=function(t){function e(){var e=t.call(this)||this,r=e.attachShadow({mode:"open"});e.canvas=document.createElement("canvas"),r.innerHTML=u,r.appendChild(e.canvas);var n=e.canvas.getContext("webgl",{antialias:!0})||e.canvas.getContext("experimental-webgl",{antialias:!0});if(!n)throw"Unable to initialize WebGL. Your browser may not support it.";return e.gl=n,e.trackball=new s.Trackball,e.trackball.attach(e),e}return n(e,t),Object.defineProperty(e.prototype,"src",{get:function(){return this.getAttribute("src")},set:function(t){t?this.setAttribute("src",t):this.removeAttribute("src")},enumerable:!0,configurable:!0}),e.prototype.resize=function(){var t=this.clientWidth,e=this.clientHeight;this.canvas.width==t&&this.canvas.height==e||(this.canvas.width=t,this.canvas.height=e)},e.prototype.draw=function(){var t=this;this.resize(),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.model.draw(this.gl,Date.now()/1e3),this.requestID=requestAnimationFrame(function(){return t.draw()})},e.prototype.update=function(){return i(this,void 0,void 0,function(){var t,e=this;return a(this,function(r){switch(r.label){case 0:return console.log("update: src = "+this.src),this.src?(t=this,[4,o.loadModel(this.src)]):[3,2];case 1:return t.model=r.sent(),this.model.setActiveCamera(function(t){return e.trackball.getViewMatrix(t)}),this.requestID=requestAnimationFrame(function(){return e.draw()}),[3,3];case 2:cancelAnimationFrame(this.requestID),r.label=3;case 3:return[2]}})})},Object.defineProperty(e,"observedAttributes",{get:function(){return["src","width","height"]},enumerable:!0,configurable:!0}),e.prototype.attributeChangedCallback=function(t,e,r){console.log("Change "+t+": "+e+" -> "+r),"src"==t?this.update():"width"==t?this.canvas.width=r:"height"==t&&(this.canvas.height=r)},e}(HTMLElement);customElements.define("gltf-viewer",c)},function(t,e,r){"use strict";function n(t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:throw"Unknown accessor type: "+t}}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this.byteStride=0,Object.assign(this,t),this.bufferView=e.buffers[t.bufferView],this.componentCount=n(this.type)}return t.prototype.bind=function(t,e){this.bufferView.bind(t),void 0!==e&&t.vertexAttribPointer(e,this.componentCount,this.componentType,!1,this.byteStride,this.byteOffset)},t.prototype.drawIndices=function(t,e){this.bufferView.bind(t),t.drawElements(e,this.count,this.componentType,this.byteOffset)},t.prototype.getView=function(){var t,e=this,r=this.bufferView.getDate(),n=0;switch(this.componentType){case 5120:n=1,t=r.getInt8;case 5121:n=1,t=r.getUint8;case 5122:n=2,t=r.getInt16;case 5123:n=2,t=r.getUint16;case 5126:n=4,t=r.getFloat32}var i=this.byteStride||n*this.componentCount;return{length:this.count,componentCount:this.componentCount,get:function(a,o){return t.call(r,e.byteOffset+a*i+(o||0)*n,!0)}}},t.prototype.getCount=function(){return this.count},t}();e.Accessor=i},function(t,e,r){"use strict";var n=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,a=r.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)o.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return o},i=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(n(arguments[e]));return t};Object.defineProperty(e,"__esModule",{value:!0});var a=r(0),o=function(){function t(t,e){Object.assign(this,t),this.node=e.nodes[this.id],this.default=this.node[this.path]}return t.prototype.setValue=function(t){this.node[this.path]=t||this.default},t}(),s=function(){function t(t,e,r){this.interpolation="LINEAR",Object.assign(this,t),this.input=r.accessors[e.parameters[t.input]].getView(),this.output=r.accessors[e.parameters[t.output]].getView()}return t.prototype.getValue=function(t){var e=this;t%=this.input.get(this.input.length-1);for(var r=this,n=0;n<this.input.length-1;++n){var o=function(n){if(t>=r.input.get(n)&&t<=r.input.get(n+1)){var o=(t-r.input.get(n))/(r.input.get(n+1)-r.input.get(n)),s=i(Array(r.output.componentCount)).map(function(t,r){return e.output.get(n,r)}),u=i(Array(r.output.componentCount)).map(function(t,r){return e.output.get(n+1,r)});return 4==r.output.componentCount?{value:a.quat.slerp(s,s,u,o)}:{value:a.vec3.lerp(s,s,u,o)}}}(n);if("object"==typeof o)return o.value}},t}(),u=function(){function t(t,e,r){Object.assign(this,t),this.target=new o(t.target,r),this.sampler=new s(e.samplers[t.sampler],e,r)}return t.prototype.applyTime=function(t){this.target.setValue(this.sampler.getValue(t))},t}(),c=function(){function t(t,e){Object.assign(this,t,{samplers:void 0,parameters:void 0}),this.channels=t.channels.map(function(r){return new u(r,t,e)})}return t.prototype.applyTime=function(t){this.channels.forEach(function(e){return e.applyTime(t)})},t}();e.Animation=c},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.byteLength=0,this.webGLBuffer=null,Object.assign(this,t),this.buffer=new DataView(e[t.buffer],this.byteOffset,this.byteLength)}return t.prototype.create=function(t){this.target&&!this.webGLBuffer&&(this.webGLBuffer=t.createBuffer(),t.bindBuffer(this.target,this.webGLBuffer),t.bufferData(this.target,this.buffer,t.STATIC_DRAW))},t.prototype.delete=function(t){t.deleteBuffer(this.webGLBuffer),this.webGLBuffer=null},t.prototype.bind=function(t){this.target&&(this.webGLBuffer||this.create(t),t.bindBuffer(this.target,this.webGLBuffer))},t.prototype.getDate=function(){return this.buffer},t}();e.BufferView=n},function(t,e,r){"use strict";var n=this&&this.__assign||Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++){e=arguments[r];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},i=this&&this.__read||function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,a=r.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)o.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return o},a=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(i(arguments[e]));return t},o=this&&this.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}};Object.defineProperty(e,"__esModule",{value:!0});var s=r(0),u=r(1),c=function(){function t(t){this.location=null,Object.assign(this,t)}return t.create=function(e,r,a,o,s){var u=a.parameters[e],c=o[u.node],l=r.values[e]||u.value;if("string"==typeof l){var h=i(s(l),2),f=h[0],p=h[1];return new t(n({},u,{value:f,node:c,texture:p}))}return new t(n({},u,{value:l,node:c}))},t}(),l=function(){function t(t,e,r,n){this.prepared=!1,Object.assign(this,e,t,{program:n.programs[e.program],parameters:void 0,values:void 0,attributes:u.map(e.attributes,function(i){return c.create(i,t,e,n.nodes,r)}),uniforms:u.map(e.uniforms,function(i){return c.create(i,t,e,n.nodes,r)})})}return t.prototype.setUniform=function(t,e,r){if(null!==e.location){var i=e.value;if(void 0===i){if(void 0===e.semantic)return;i=this.createUniform(t,e.semantic,e.node?n({},r,{local:e.node.local,model:e.node.model}):r)}switch(e.type){case t.FLOAT:t.uniform1f(e.location,i);break;case t.FLOAT_VEC2:t.uniform2fv(e.location,i);break;case t.FLOAT_VEC3:t.uniform3fv(e.location,i);break;case t.FLOAT_VEC4:t.uniform4fv(e.location,i);break;case t.FLOAT_MAT2:t.uniformMatrix2fv(e.location,!1,i);break;case t.FLOAT_MAT3:t.uniformMatrix3fv(e.location,!1,i);break;case t.FLOAT_MAT4:t.uniformMatrix4fv(e.location,!1,i);break;case t.SAMPLER_2D:t.uniform1i(e.location,i);break;default:console.warn("Need set uniform of type "+e.type+".",e)}}},t.prototype.createUniform=function(t,e,r){var n=s.mat4.create();switch(e){case"LOCAL":return r.local;case"MODEL":return r.model;case"VIEW":return r.view;case"PROJECTION":return r.projection;case"MODELVIEW":return s.mat4.multiply(n,r.view,r.model);case"MODELVIEWPROJECTION":return s.mat4.multiply(n,r.projection,s.mat4.multiply(n,r.view,r.model));case"MODELINVERSE":return s.mat4.invert(n,r.model);case"VIEWINVERSE":return s.mat4.invert(n,r.view);case"PROJECTIONINVERSE":return s.mat4.invert(n,r.projection);case"MODELVIEWINVERSE":return s.mat4.invert(n,s.mat4.multiply(n,r.view,r.model));case"MODELVIEWPROJECTIONINVERSE":return s.mat4.invert(n,s.mat4.multiply(n,r.projection,s.mat4.multiply(n,r.view,r.model)));case"MODELINVERSETRANSPOSE":return s.mat3.normalFromMat4(s.mat3.create(),r.model);case"MODELVIEWINVERSETRANSPOSE":return s.mat3.normalFromMat4(s.mat3.create(),s.mat4.multiply(n,r.view,r.model));case"VIEWPORT":return a(t.getParameter(t.VIEWPORT));case"JOINTMATRIX":default:return console.warn("'Need uniform with semantic: "+e),n}},t.prototype.prepare=function(t){this.program.create(t);try{for(var e=o(u.enumerate(this.attributes)),r=e.next();!r.done;r=e.next()){var n=i(r.value,2),a=n[0],s=n[1];s.location=this.program.getAttribLocation(t,a)}}catch(t){p={error:t}}finally{try{r&&!r.done&&(d=e.return)&&d.call(e)}finally{if(p)throw p.error}}try{for(var c=o(u.enumerate(this.uniforms)),l=c.next();!l.done;l=c.next()){var h=i(l.value,2),f=h[0],s=h[1];s.location=this.program.getUniformLocation(t,f)}}catch(t){m={error:t}}finally{try{l&&!l.done&&(v=c.return)&&v.call(c)}finally{if(m)throw m.error}}this.prepared=!0;var p,d,m,v},t.prototype.begin=function(t,e,r){this.prepared||this.prepare(t),this.program.use(t);try{for(var n=o(u.enumerate(this.attributes)),a=n.next();!a.done;a=n.next()){var s=i(a.value,2),c=(s[0],s[1]);-1!=c.location&&(e(c.semantic).bind(t,c.location),t.enableVertexAttribArray(c.location))}}catch(t){v={error:t}}finally{try{a&&!a.done&&(y=n.return)&&y.call(n)}finally{if(v)throw v.error}}try{for(var l=o(u.enumerate(this.uniforms)),h=l.next();!h.done;h=l.next()){var f=i(h.value,2),c=(f[0],f[1]);null!==c.location&&(this.setUniform(t,c,r),void 0!==c.texture&&c.texture.bind(t,t.TEXTURE0+c.value))}}catch(t){b={error:t}}finally{try{h&&!h.done&&(w=l.return)&&w.call(l)}finally{if(b)throw b.error}}if(this.states)try{for(var p=o(this.states.enable||[]),d=p.next();!d.done;d=p.next()){var m=d.value;t.enable(m)}}catch(t){g={error:t}}finally{try{d&&!d.done&&(x=p.return)&&x.call(p)}finally{if(g)throw g.error}}var v,y,b,w,g,x},t.prototype.end=function(t){if(this.states)try{for(var e=o(this.states.enable||[]),r=e.next();!r.done;r=e.next()){var n=r.value;t.disable(n)}}catch(t){h={error:t}}finally{try{r&&!r.done&&(f=e.return)&&f.call(e)}finally{if(h)throw h.error}}try{for(var a=o(u.enumerate(this.attributes)),s=a.next();!s.done;s=a.next()){var c=i(s.value,2),l=(c[0],c[1]);-1!=l.location&&t.disableVertexAttribArray(l.location)}}catch(t){p={error:t}}finally{try{s&&!s.done&&(d=a.return)&&d.call(a)}finally{if(p)throw p.error}}var h,f,p,d},t}();e.Material=l},function(t,e,r){"use strict";var n=this&&this.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}};Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),a=function(){function t(t,e){this.mode=4,Object.assign(this,t,{indices:e.accessors[t.indices],material:e.materials[t.material],attributes:i.map(t.attributes,function(t){return e.accessors[t]})})}return t.prototype.draw=function(t,e){var r=this;this.material.begin(t,function(t){return r.attributes[t]},e),this.indices?this.indices.drawIndices(t,this.mode):t.drawArrays(this.mode,0,i.first(this.attributes).getCount()),this.material.end(t)},t}(),o=function(){function t(t,e){Object.assign(this,t,{primitives:t.primitives.map(function(t){return new a(t,e)})})}return t.prototype.draw=function(t,e,r){var i={local:e.local,model:e.model,view:r.view,projection:r.projection};try{for(var a=n(this.primitives),o=a.next();!o.done;o=a.next()){o.value.draw(t,i)}}catch(t){s={error:t}}finally{try{o&&!o.done&&(u=a.return)&&u.call(a)}finally{if(s)throw s.error}}var s,u},t}();e.Mesh=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(0),i=r(2),a=function(){function t(t){this.children=[],this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.meshes=[],Object.assign(this,t)}return t.prototype.init=function(t,e){this.camera&&(this.cameraObj=new i.Camera(e[this.camera],this)),this.childrenObj=this.children.map(function(e){return t.nodes[e]}),this.meshesObj=this.meshes.map(function(e){return t.meshes[e]})},t.prototype.addCameras=function(t){this.cameraObj&&t.push(this.cameraObj),this.childrenObj.forEach(function(e){return e.addCameras(t)})},t.prototype.getViewMatrix=function(){return n.mat4.invert(n.mat4.create(),this.model)},t.prototype.update=function(t){var e=this;this.translation||this.rotation||this.scale?this.local=n.mat4.fromRotationTranslationScale(n.mat4.create(),this.rotation||[0,0,0,1],this.translation||[0,0,0],this.scale||[1,1,1]):this.matrix&&(this.local=n.mat4.clone(this.matrix)),this.model=t?n.mat4.multiply(n.mat4.create(),t.model,this.local):this.local,this.childrenObj.forEach(function(t){return t.update(e)})},t.prototype.draw=function(t,e){var r=this;this.childrenObj.forEach(function(r){return r.draw(t,e)}),this.meshesObj.forEach(function(n){return n.draw(t,r,e)})},t}();e.Node=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.attributes=[],this.webGLProgram=null,Object.assign(this,t,{fragmentShader:e.shaders[t.fragmentShader],vertexShader:e.shaders[t.vertexShader]})}return t.prototype.create=function(t){if(!this.webGLProgram&&(this.webGLProgram=t.createProgram(),t.attachShader(this.webGLProgram,this.vertexShader.create(t)),t.attachShader(this.webGLProgram,this.fragmentShader.create(t)),t.linkProgram(this.webGLProgram),!t.getProgramParameter(this.webGLProgram,t.LINK_STATUS)))throw"Can't link program. Error: "+t.getProgramInfoLog(this.webGLProgram)},t.prototype.delete=function(t){t.deleteProgram(this.webGLProgram),this.webGLProgram=null},t.prototype.getAttribLocation=function(t,e){return t.getAttribLocation(this.webGLProgram,e)},t.prototype.getUniformLocation=function(t,e){return t.getUniformLocation(this.webGLProgram,e)},t.prototype.use=function(t){t.useProgram(this.webGLProgram)},t}();e.Program=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){var r=this;this.nodes=[],this.cameras=[],Object.assign(this,t,{nodes:(t.nodes||[]).map(function(t){return e.nodes[t]})}),this.nodes.forEach(function(t){return t.addCameras(r.cameras)}),this.activeCamera=this.cameras[0]}return t.prototype.update=function(){this.nodes.forEach(function(t){return t.update()}),this.activeCamera.updateView()},t.prototype.draw=function(t){var e=this;this.update(),this.activeCamera.updateProjection(t),this.nodes.forEach(function(r){return r.draw(t,e.activeCamera)})},t}();e.Scene=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.webGLShader=null,Object.assign(this,t,{uri:void 0}),this.source=e}return t.prototype.create=function(t){if(!this.webGLShader&&(this.webGLShader=t.createShader(this.type),t.shaderSource(this.webGLShader,this.source),t.compileShader(this.webGLShader),!t.getShaderParameter(this.webGLShader,t.COMPILE_STATUS)))throw"Can't compile shader. Error: "+t.getShaderInfoLog(this.webGLShader);return this.webGLShader},t.prototype.delete=function(t){t.deleteShader(this.webGLShader),this.webGLShader=null},t}();e.Shader=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(e,r,n){this.format=6408,this.internalFormat=6408,this.target=3553,this.type=5121,this.magFilter=9729,this.minFilter=9986,this.wrapS=10497,this.wrapT=10497,this.webGLTexture=null,Object.assign(this,r,e,{source:n}),this.useMipMap=9984==this.minFilter||9986==this.minFilter||9985==this.minFilter||9987==this.minFilter;var i=10497==this.wrapS||33648==this.wrapS||10497==this.wrapT||33648==this.wrapT;(this.useMipMap||i)&&(this.source=t.resizeIfNeed(n))}return t.resizeIfNeed=function(t){var e=function(t){return 0==(t&t-1)},r=function(t){--t;for(var e=1;e<32;e<<=1)t|=t>>e;return t+1};if(e(t.width)&&e(t.height))return t;var n=document.createElement("canvas");return n.width=r(t.width),n.height=r(t.height),n.getContext("2d").drawImage(t,0,0,n.width,n.height),n},t.prototype.create=function(t){this.webGLTexture||(this.webGLTexture=t.createTexture(),t.bindTexture(this.target,this.webGLTexture),t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,this.magFilter),t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,this.minFilter),t.texParameteri(this.target,t.TEXTURE_WRAP_S,this.wrapS),t.texParameteri(this.target,t.TEXTURE_WRAP_T,this.wrapT),t.texImage2D(this.target,0,this.internalFormat,this.format,this.type,this.source),this.useMipMap&&t.generateMipmap(t.TEXTURE_2D))},t.prototype.delete=function(t){t.deleteTexture(this.webGLTexture),this.webGLTexture=null},t.prototype.bind=function(t,e){t.activeTexture(e),this.webGLTexture||this.create(t),t.bindTexture(this.target,this.webGLTexture)},t.textureCollection=function(t){var e=0,r={};return function(n){return void 0===r[n]&&(r[n]=e++),[r[n],t[n]]}},t}();e.Texture=n}])});